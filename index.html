
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Documentation</title>

    <style>
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight .gh {
  color: #999999;
}
.highlight .sr {
  color: #f6aa11;
}
.highlight .go {
  color: #888888;
}
.highlight .gp {
  color: #555555;
}
.highlight .gs {
}
.highlight .gu {
  color: #aaaaaa;
}
.highlight .nb {
  color: #f6aa11;
}
.highlight .cm {
  color: #75715e;
}
.highlight .cp {
  color: #75715e;
}
.highlight .c1 {
  color: #75715e;
}
.highlight .cs {
  color: #75715e;
}
.highlight .c, .highlight .cd {
  color: #75715e;
}
.highlight .err {
  color: #960050;
}
.highlight .gr {
  color: #960050;
}
.highlight .gt {
  color: #960050;
}
.highlight .gd {
  color: #49483e;
}
.highlight .gi {
  color: #49483e;
}
.highlight .ge {
  color: #49483e;
}
.highlight .kc {
  color: #66d9ef;
}
.highlight .kd {
  color: #66d9ef;
}
.highlight .kr {
  color: #66d9ef;
}
.highlight .no {
  color: #66d9ef;
}
.highlight .kt {
  color: #66d9ef;
}
.highlight .mf {
  color: #ae81ff;
}
.highlight .mh {
  color: #ae81ff;
}
.highlight .il {
  color: #ae81ff;
}
.highlight .mi {
  color: #ae81ff;
}
.highlight .mo {
  color: #ae81ff;
}
.highlight .m, .highlight .mb, .highlight .mx {
  color: #ae81ff;
}
.highlight .sc {
  color: #ae81ff;
}
.highlight .se {
  color: #ae81ff;
}
.highlight .ss {
  color: #ae81ff;
}
.highlight .sd {
  color: #e6db74;
}
.highlight .s2 {
  color: #e6db74;
}
.highlight .sb {
  color: #e6db74;
}
.highlight .sh {
  color: #e6db74;
}
.highlight .si {
  color: #e6db74;
}
.highlight .sx {
  color: #e6db74;
}
.highlight .s1 {
  color: #e6db74;
}
.highlight .s {
  color: #e6db74;
}
.highlight .na {
  color: #a6e22e;
}
.highlight .nc {
  color: #a6e22e;
}
.highlight .nd {
  color: #a6e22e;
}
.highlight .ne {
  color: #a6e22e;
}
.highlight .nf {
  color: #a6e22e;
}
.highlight .vc {
  color: #ffffff;
}
.highlight .nn {
  color: #ffffff;
}
.highlight .nl {
  color: #ffffff;
}
.highlight .ni {
  color: #ffffff;
}
.highlight .bp {
  color: #ffffff;
}
.highlight .vg {
  color: #ffffff;
}
.highlight .vi {
  color: #ffffff;
}
.highlight .nv {
  color: #ffffff;
}
.highlight .w {
  color: #ffffff;
}
.highlight {
  color: #ffffff;
}
.highlight .n, .highlight .py, .highlight .nx {
  color: #ffffff;
}
.highlight .ow {
  color: #f92672;
}
.highlight .nt {
  color: #f92672;
}
.highlight .k, .highlight .kv {
  color: #f92672;
}
.highlight .kn {
  color: #f92672;
}
.highlight .kp {
  color: #f92672;
}
.highlight .o {
  color: #f92672;
}
    </style>
    <link href="stylesheets/screen.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" media="print" />
      <script src="javascripts/all.js"></script>
  </head>

  <body class="index" data-languages="[&quot;javascript&quot;]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" alt="Navbar" />
      </span>
    </a>
    <div class="toc-wrapper">
      <img src="images/logo.png" class="logo" alt="Logo" />
        <div class="lang-selector">
              <a href="#" data-language-name="javascript">javascript</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div id="toc" class="toc-list-h1">
          <li>
            <a href="#dai-js" class="toc-h1 toc-link" data-title="dai-js">Dai.js</a>
          </li>
          <li>
            <a href="#getting-started" class="toc-h1 toc-link" data-title="getting-started">Getting Started</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#installation" class="toc-h2 toc-link" data-title="installation">Installation</a>
                  </li>
                  <li>
                    <a href="#quick-example" class="toc-h2 toc-link" data-title="quick-example">Quick Example</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#maker" class="toc-h1 toc-link" data-title="maker">Maker</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#presets" class="toc-h2 toc-link" data-title="presets">Presets</a>
                  </li>
                  <li>
                    <a href="#options" class="toc-h2 toc-link" data-title="options">Options</a>
                  </li>
                  <li>
                    <a href="#authenticate" class="toc-h2 toc-link" data-title="strong-authenticate-strong"><strong>authenticate</strong></a>
                  </li>
                  <li>
                    <a href="#service" class="toc-h2 toc-link" data-title="strong-service-strong"><strong>service</strong></a>
                  </li>
                  <li>
                    <a href="#opencdp" class="toc-h2 toc-link" data-title="strong-opencdp-strong"><strong>openCdp</strong></a>
                  </li>
                  <li>
                    <a href="#getcdp" class="toc-h2 toc-link" data-title="strong-getcdp-strong"><strong>getCdp</strong></a>
                  </li>
                  <li>
                    <a href="#units" class="toc-h2 toc-link" data-title="units">Units</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#cdp" class="toc-h1 toc-link" data-title="cdp">CDP</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#getid" class="toc-h2 toc-link" data-title="strong-getid-strong"><strong>getId</strong></a>
                  </li>
                  <li>
                    <a href="#getdebtvalue" class="toc-h2 toc-link" data-title="strong-getdebtvalue-strong"><strong>getDebtValue</strong></a>
                  </li>
                  <li>
                    <a href="#getgovernancefee" class="toc-h2 toc-link" data-title="strong-getgovernancefee-strong"><strong>getGovernanceFee</strong></a>
                  </li>
                  <li>
                    <a href="#getcollateralizationratio" class="toc-h2 toc-link" data-title="strong-getcollateralizationratio-strong"><strong>getCollateralizationRatio</strong></a>
                  </li>
                  <li>
                    <a href="#getliquidationprice" class="toc-h2 toc-link" data-title="strong-getliquidationprice-strong"><strong>getLiquidationPrice</strong></a>
                  </li>
                  <li>
                    <a href="#getcollateralvalue" class="toc-h2 toc-link" data-title="strong-getcollateralvalue-strong"><strong>getCollateralValue</strong></a>
                  </li>
                  <li>
                    <a href="#issafe" class="toc-h2 toc-link" data-title="strong-issafe-strong"><strong>isSafe</strong></a>
                  </li>
                  <li>
                    <a href="#locketh" class="toc-h2 toc-link" data-title="strong-locketh-strong"><strong>lockEth</strong></a>
                  </li>
                  <li>
                    <a href="#drawdai" class="toc-h2 toc-link" data-title="strong-drawdai-strong"><strong>drawDai</strong></a>
                  </li>
                  <li>
                    <a href="#wipedai" class="toc-h2 toc-link" data-title="strong-wipedai-strong"><strong>wipeDai</strong></a>
                  </li>
                  <li>
                    <a href="#freepeth" class="toc-h2 toc-link" data-title="strong-freepeth-strong"><strong>freePeth</strong></a>
                  </li>
                  <li>
                    <a href="#give" class="toc-h2 toc-link" data-title="strong-give-strong"><strong>give</strong></a>
                  </li>
                  <li>
                    <a href="#shut" class="toc-h2 toc-link" data-title="strong-shut-strong"><strong>shut</strong></a>
                  </li>
                  <li>
                    <a href="#bite" class="toc-h2 toc-link" data-title="strong-bite-strong"><strong>bite</strong></a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#price-service" class="toc-h1 toc-link" data-title="price-service">Price Service</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#getethprice" class="toc-h2 toc-link" data-title="getethprice">getEthPrice</a>
                  </li>
                  <li>
                    <a href="#getmkrprice" class="toc-h2 toc-link" data-title="getmkrprice">getMkrPrice</a>
                  </li>
                  <li>
                    <a href="#getpethprice" class="toc-h2 toc-link" data-title="getpethprice">getPethPrice</a>
                  </li>
                  <li>
                    <a href="#setethprice" class="toc-h2 toc-link" data-title="setethprice">setEthPrice</a>
                  </li>
                  <li>
                    <a href="#setmkrprice" class="toc-h2 toc-link" data-title="setmkrprice">setMkrPrice</a>
                  </li>
                  <li>
                    <a href="#getwethtopethratio" class="toc-h2 toc-link" data-title="getwethtopethratio">getWethToPethRatio</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#eth-cdp-service" class="toc-h1 toc-link" data-title="eth-cdp-service">ETH CDP Service</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#getliquidationratio" class="toc-h2 toc-link" data-title="strong-getliquidationratio-strong"><strong>getLiquidationRatio</strong></a>
                  </li>
                  <li>
                    <a href="#getliquidationpenalty" class="toc-h2 toc-link" data-title="strong-getliquidationpenalty-strong"><strong>getLiquidationPenalty</strong></a>
                  </li>
                  <li>
                    <a href="#getannualgovernancefee" class="toc-h2 toc-link" data-title="strong-getannualgovernancefee-strong"><strong>getAnnualGovernanceFee</strong></a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#exchange-service" class="toc-h1 toc-link" data-title="exchange-service">Exchange Service</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#selldai" class="toc-h2 toc-link" data-title="selldai">sellDai</a>
                  </li>
                  <li>
                    <a href="#buydai" class="toc-h2 toc-link" data-title="buydai">buyDai</a>
                  </li>
                  <li>
                    <a href="#oasisorder" class="toc-h2 toc-link" data-title="oasisorder">OasisOrder</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#system-status" class="toc-h1 toc-link" data-title="system-status">System Status</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#getsystemcollateralization" class="toc-h2 toc-link" data-title="strong-getsystemcollateralization-strong"><strong>getSystemCollateralization</strong></a>
                  </li>
                  <li>
                    <a href="#gettargetprice" class="toc-h2 toc-link" data-title="strong-gettargetprice-strong"><strong>getTargetPrice</strong></a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#events" class="toc-h1 toc-link" data-title="events">Events</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#wildcards" class="toc-h2 toc-link" data-title="wildcards">Wildcards</a>
                  </li>
                  <li>
                    <a href="#event-object" class="toc-h2 toc-link" data-title="event-object">Event Object</a>
                  </li>
                  <li>
                    <a href="#maker-object" class="toc-h2 toc-link" data-title="maker-object">Maker Object</a>
                  </li>
                  <li>
                    <a href="#cdp-object" class="toc-h2 toc-link" data-title="cdp-object">CDP Object</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#transactions" class="toc-h1 toc-link" data-title="transactions">Transactions</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#transactionobject-lifecycle-hooks" class="toc-h2 toc-link" data-title="transactionobject-lifecycle-hooks">TransactionObject Lifecycle Hooks</a>
                  </li>
                  <li>
                    <a href="#transactionobject-transaction-data" class="toc-h2 toc-link" data-title="transactionobject-transaction-data">TransactionObject Transaction Data</a>
                  </li>
                  <li>
                    <a href="#onnewtransaction" class="toc-h2 toc-link" data-title="onnewtransaction">onNewTransaction</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#using-multiple-accounts" class="toc-h1 toc-link" data-title="using-multiple-accounts">Using Multiple Accounts</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#account-types" class="toc-h2 toc-link" data-title="account-types">Account types</a>
                  </li>
                  <li>
                    <a href="#plugins" class="toc-h2 toc-link" data-title="plugins">Plugins</a>
                  </li>
                  <li>
                    <a href="#demo" class="toc-h2 toc-link" data-title="demo">Demo</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#developing" class="toc-h1 toc-link" data-title="developing">Developing</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#running-the-tests" class="toc-h2 toc-link" data-title="running-the-tests">Running the tests</a>
                  </li>
                  <li>
                    <a href="#inspect-contract-state" class="toc-h2 toc-link" data-title="inspect-contract-state">Inspect contract state</a>
                  </li>
                  <li>
                    <a href="#commands" class="toc-h2 toc-link" data-title="commands">Commands</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#adding-a-new-service" class="toc-h1 toc-link" data-title="adding-a-new-service">Adding a New Service</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#steps-to-add-a-new-service" class="toc-h2 toc-link" data-title="steps-to-add-a-new-service">Steps to add a new service</a>
                  </li>
                  <li>
                    <a href="#service-lifecycle" class="toc-h2 toc-link" data-title="service-lifecycle">Service Lifecycle</a>
                  </li>
                  <li>
                    <a href="#adding-custom-events" class="toc-h2 toc-link" data-title="adding-custom-events">Adding Custom Events</a>
                  </li>
              </ul>
          </li>
      </div>
        <ul class="toc-footer">
            <li><a href='https://github.com/lord/slate'>Documentation Powered by Slate</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id='dai-js'>Dai.js</h1>
<p><a href="https://travis-ci.org/jluccisano/webpack-es6-boilerplate"><img src="http://img.shields.io/travis/jluccisano/webpack-es6-boilerplate.svg" alt="tests" /></a>
<a href="https://codecov.io/gh/jluccisano/webpack-es6-boilerplate"><img src="https://codecov.io/gh/jluccisano/webpack-es6-boilerplate/branch/master/graph/badge.svg" alt="coverage" /></a></p>

<p><strong>Dai.js</strong> is a JavaScript library that makes it easy to build applications on top of MakerDAO&#39;s platform of smart contracts. You can use Maker&#39;s contracts to open Collateralized Debt Positions (CDPs), withdraw loans in Dai, trade tokens on OasisDEX, and more.</p>

<p>The library features a pluggable, service-based architecture, which allows users maximal control when integrating the Maker functionality into existing infrastructures. It also includes convenient configuration presets for out-of-the-box usability, a powerful smart contract state inspector, and support for both front-end and back-end applications.</p>

<p>Maker&#39;s entire suite of contracts will eventually be accessible through this library—including the DAO governance and the upcoming multi-collateral release—but functionality is limited in the current alpha version to the following areas:</p>

<ul>
<li>Opening and closing CDPs</li>
<li>Locking and unlocking collateral</li>
<li>Withdrawing and repaying Dai</li>
<li>Automated token conversions</li>
<li>Token contract functionality for WETH, PETH, MKR, Dai, and ETH</li>
<li>Buying and selling MKR and Dai with built-in DEX integration</li>
</ul>

<p>For example code that consumes the library, check out <a href="https://github.com/makerdao/integration-examples">this repository</a>.</p>
<h1 id='getting-started'>Getting Started</h1><h2 id='installation'>Installation</h2><pre class="highlight javascript tab-javascript"><code><span class="kr">import</span> <span class="nx">Maker</span> <span class="nx">from</span> <span class="s1">'@makerdao/dai'</span><span class="p">;</span>
<span class="c1">// or:</span>
<span class="kr">const</span> <span class="nx">Maker</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'@makerdao/dai'</span><span class="p">);</span>
</code></pre>
<p>Install the package with npm:</p>

<p><code>npm install @makerdao/dai</code></p>

<p>Once it&#39;s installed, import the module into your project as shown on the right.</p>
<h3 id='umd'>UMD</h3><pre class="highlight html tab-html"><code><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"./dai.js"</span> <span class="nt">/&gt;</span>

<span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>
<span class="kd">var</span> <span class="nx">maker</span> <span class="o">=</span> <span class="nx">Maker</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s1">'kovan'</span><span class="p">,</span> <span class="p">{</span> <span class="na">privateKey</span><span class="p">:</span> <span class="nx">YOUR_PRIVATE_KEY</span> <span class="p">});</span>

<span class="nx">maker</span><span class="p">.</span><span class="nx">authenticate</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">maker</span><span class="p">.</span><span class="nx">openCdp</span><span class="p">())</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">cdp</span> <span class="o">=&gt;</span> <span class="nx">cdp</span><span class="p">.</span><span class="nx">getId</span><span class="p">())</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">id</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">id</span><span class="p">));</span>
<span class="nt">&lt;/script&gt;</span>
</code></pre>
<p>This library is also accessible as a <a href="https://github.com/umdjs/umd">UMD module</a>.</p>
<h2 id='quick-example'>Quick Example</h2><pre class="highlight javascript tab-javascript"><code><span class="kr">import</span> <span class="nx">Maker</span> <span class="nx">from</span> <span class="s1">'@makerdao/dai'</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">maker</span> <span class="o">=</span> <span class="nx">Maker</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s2">"kovan"</span><span class="p">,</span> <span class="p">{</span> <span class="na">privateKey</span><span class="p">:</span> <span class="nx">YOUR_PRIVATE_KEY</span> <span class="p">});</span>

<span class="nx">async</span> <span class="kd">function</span> <span class="nx">openLockDraw</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">await</span> <span class="nx">maker</span><span class="p">.</span><span class="nx">authenticate</span><span class="p">();</span>
  <span class="kr">const</span> <span class="nx">cdp</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">maker</span><span class="p">.</span><span class="nx">openCdp</span><span class="p">();</span>

  <span class="nx">await</span> <span class="nx">cdp</span><span class="p">.</span><span class="nx">lockEth</span><span class="p">(</span><span class="mf">0.25</span><span class="p">);</span>
  <span class="nx">await</span> <span class="nx">cdp</span><span class="p">.</span><span class="nx">drawDai</span><span class="p">(</span><span class="mi">50</span><span class="p">);</span>

  <span class="kr">const</span> <span class="nx">debt</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">cdp</span><span class="p">.</span><span class="nx">getDebtValue</span><span class="p">();</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">debt</span><span class="p">.</span><span class="nx">toString</span><span class="p">);</span> <span class="c1">// '50.00 DAI'</span>
<span class="p">}</span>

<span class="nx">openLockDraw</span><span class="p">();</span>
</code></pre>
<p>Using the <a href="#maker">Maker</a> and <a href="#cdp">Cdp</a> APIs, the code shown on the right
opens a cdp, locks 0.25 ETH into it, draws out 50 Dai, and then logs information
about the newly opened position to the console.</p>
<h1 id='maker'>Maker</h1><h2 id='presets'>Presets</h2><pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">makerBrowser</span> <span class="o">=</span> <span class="nx">Maker</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s1">'browser'</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">makerHttp</span> <span class="o">=</span> <span class="nx">Maker</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s1">'http'</span><span class="p">,</span> <span class="p">{</span>
  <span class="na">privateKey</span><span class="p">:</span> <span class="nx">YOUR_PRIVATE_KEY</span><span class="p">,</span>
  <span class="na">url</span><span class="p">:</span> <span class="s1">'https://sai-service.makerdao.com/node'</span>
<span class="p">});</span>

<span class="kr">const</span> <span class="nx">makerKovan</span> <span class="o">=</span> <span class="nx">Maker</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s1">'kovan'</span><span class="p">,</span> <span class="p">{</span>
  <span class="na">privateKey</span><span class="p">:</span> <span class="nx">YOUR_PRIVATE_KEY</span><span class="p">,</span>
  <span class="na">provider</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">infuraApiKey</span><span class="p">:</span> <span class="nx">YOUR_INFURA_API_KEY</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="kr">const</span> <span class="nx">makerTest</span> <span class="o">=</span> <span class="nx">Maker</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s1">'test'</span><span class="p">);</span>
</code></pre>
<p>When instantiating a <code>Maker</code> object, you pass in the name of a configuration preset
and an options hash.</p>

<p>Available presets are listed below, with the required options for each shown on the
right.</p>

<ul>
<li><code>&#39;browser&#39;</code>

<ul>
<li>Use the provider from the browser (e.g. MetaMask).</li>
</ul></li>
<li><code>&#39;http&#39;</code>

<ul>
<li>Use Web3.providers.HttpProvider.</li>
</ul></li>
<li><code>&#39;kovan&#39;</code>

<ul>
<li>Use the Kovan testnet via Infura.</li>
</ul></li>
<li><code>&#39;test&#39;</code>

<ul>
<li>Use a local testnet (e.g. Ganache) running at <code>http://127.0.0.1:2000</code>, and
sign transactions using testnet-managed keys.</li>
</ul></li>
<li><code>&#39;mainnet&#39;</code>

<ul>
<li>Use the main Ethereum network via Infura.</li>
</ul></li>
</ul>
<h2 id='options'>Options</h2><pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">maker</span> <span class="o">=</span> <span class="nx">Maker</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s1">'http'</span><span class="p">,</span> <span class="p">{</span>
  <span class="na">privateKey</span><span class="p">:</span> <span class="nx">YOUR_PRIVATE_KEY</span><span class="p">,</span> <span class="c1">// '0xabc...'</span>
  <span class="na">url</span><span class="p">:</span> <span class="s1">'https://sai-service.makerdao.com/node'</span><span class="p">,</span>
  <span class="na">provider</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">type</span><span class="p">:</span> <span class="s1">'HTTP'</span><span class="p">,</span> <span class="c1">// 'INFURA', 'TEST'</span>
    <span class="na">network</span><span class="p">:</span> <span class="s1">'kovan'</span><span class="p">,</span>
    <span class="na">infuraApiKey</span><span class="p">:</span> <span class="nx">YOUR_INFURA_API_KEY</span>
  <span class="p">},</span>
  <span class="na">web3</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">statusTimerDelay</span><span class="p">:</span> <span class="mi">2000</span><span class="p">,</span>
    <span class="na">transactionSettings</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">gasPrice</span><span class="p">:</span> <span class="mi">12000000000</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="nl">log</span><span class="p">:</span> <span class="kc">false</span>
<span class="p">});</span>
</code></pre>
<ul>
<li><code>privateKey</code>

<ul>
<li>The private key used to sign transactions. If not provided, the first account available from the Ethereum provider will be used.</li>
</ul></li>
<li><code>url</code>

<ul>
<li>The URL of the node to connect to. Only used when <code>provider.type</code> is <code>&quot;HTTP&quot;</code>.</li>
<li>Default value: <code>&quot;https://sai-service.makerdao.com/node&quot;</code></li>
</ul></li>
<li><code>provider.infuraApiKey</code>

<ul>
<li>Your Infura unique access token (the part after infura.io/ when accessing Infura via https). Only used when <code>provider.type</code> is <code>&quot;INFURA&quot;</code>.</li>
</ul></li>
<li><code>provider.type</code>

<ul>
<li><code>&quot;INFURA&quot;</code>: connect to an Ethereum node via infura</li>
<li><code>&quot;TEST&quot;</code>: connect to a local test blockchain at &#39;http://127.1:2000&#39;</li>
<li><code>&quot;HTTP&quot;</code>: connect to an Ethereum node via any arbitrary url</li>
</ul></li>
<li><code>web3.statusTimerDelay</code>

<ul>
<li>Number in milliseconds that represents how often the blockchain connection and account authentication is checked. This allows the library to move out of an authenticated or connected state when it discovers it no longer has access to unlocked accounts, or can no longer connect to a node.</li>
<li>Default value: 5000 (5 seconds)</li>
</ul></li>
<li><code>web3.transactionSettings</code>

<ul>
<li>Object containing transaction options to be applied to all transactions sent through the library.</li>
<li>Default value: <code>{ gasLimit: 4000000 }</code></li>
</ul></li>
<li><code>log</code>

<ul>
<li>Set this to <code>false</code> to reduce the verbosity of logging.</li>
</ul></li>
</ul>
<h2 id='authenticate'><strong>authenticate</strong></h2><pre class="highlight javascript tab-javascript"><code><span class="nx">await</span> <span class="nx">maker</span><span class="p">.</span><span class="nx">authenticate</span><span class="p">();</span>
</code></pre>
<p>After creating your Maker instance, and before using any other methods, run this. It makes sure all services are initialized, connected to any remote API&#39;s, and properly authenticated.</p>
<h2 id='service'><strong>service</strong></h2><pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">priceService</span> <span class="o">=</span> <span class="nx">maker</span><span class="p">.</span><span class="nx">service</span><span class="p">(</span><span class="s1">'price'</span><span class="p">);</span>
</code></pre>
<ul>
<li><strong>Params:</strong> service (string)</li>
<li><strong>Returns:</strong> service object</li>
</ul>

<p>The service function can be used to access services that were injected into your instance of <code>maker</code>. See the service documentation sections below.</p>
<h2 id='opencdp'><strong>openCdp</strong></h2><pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">newCdp</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">maker</span><span class="p">.</span><span class="nx">openCdp</span><span class="p">();</span>
</code></pre>
<ul>
<li><strong>Params:</strong> none</li>
<li><strong>Returns:</strong> promise (resolves to new CDP object once mined)</li>
</ul>

<p><code>maker.openCdp()</code> will create a new CDP, and then return the CDP object, which can be used to access other CDP functionality.</p>

<p>The promise will resolve when the transaction is mined.</p>
<h2 id='getcdp'><strong>getCdp</strong></h2><pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">cdp</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">maker</span><span class="p">.</span><span class="nx">getCdp</span><span class="p">(</span><span class="mi">614</span><span class="p">);</span>
</code></pre>
<ul>
<li><strong>Params:</strong> CDP ID (integer)</li>
<li><strong>Returns:</strong> promise (resolves to CDP object)</li>
</ul>

<p><code>maker.getCdp(id)</code> creates a CDP object for an existing CDP. The CDP object can then be used to interact with your CDP.</p>
<h2 id='units'>Units</h2><pre class="highlight javascript tab-javascript"><code><span class="kr">import</span> <span class="nx">Maker</span> <span class="nx">from</span> <span class="s1">'@makerdao/dai'</span><span class="p">;</span>
<span class="kr">const</span> <span class="p">{</span>
  <span class="nx">MKR</span><span class="p">,</span>
  <span class="nx">DAI</span><span class="p">,</span>
  <span class="nx">ETH</span><span class="p">,</span>
  <span class="nx">WETH</span><span class="p">,</span>
  <span class="nx">PETH</span><span class="p">,</span>
  <span class="nx">USD_ETH</span><span class="p">,</span>
  <span class="nx">USD_MKR</span><span class="p">,</span>
  <span class="nx">USD_DAI</span>
<span class="p">}</span> <span class="o">=</span> <span class="nx">Maker</span><span class="p">;</span>

<span class="c1">// These are all identical:</span>

<span class="c1">// each method has a default type</span>
<span class="nx">cdp</span><span class="p">.</span><span class="nx">lockEth</span><span class="p">(</span><span class="mf">0.25</span><span class="p">);</span>
<span class="nx">cdp</span><span class="p">.</span><span class="nx">lockEth</span><span class="p">(</span><span class="s1">'0.25'</span><span class="p">);</span>

<span class="c1">// you can pass in a currency unit instance</span>
<span class="nx">cdp</span><span class="p">.</span><span class="nx">lockEth</span><span class="p">(</span><span class="nx">ETH</span><span class="p">(</span><span class="mf">0.25</span><span class="p">));</span>
<span class="nx">cdp</span><span class="p">.</span><span class="nx">lockEth</span><span class="p">(</span><span class="nx">ETH</span><span class="p">.</span><span class="nx">wei</span><span class="p">(</span><span class="mi">250000000000000000</span><span class="p">));</span>

<span class="c1">// you can pass the unit as a second argument</span>
<span class="nx">cdp</span><span class="p">.</span><span class="nx">lockEth</span><span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="nx">ETH</span><span class="p">);</span>
<span class="nx">cdp</span><span class="p">.</span><span class="nx">lockEth</span><span class="p">(</span><span class="mi">250000000000000000</span><span class="p">,</span> <span class="nx">ETH</span><span class="p">.</span><span class="nx">wei</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">eth</span> <span class="o">=</span> <span class="nx">ETH</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
<span class="nx">eth</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span> <span class="o">==</span> <span class="s1">'5.00 ETH'</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">price</span> <span class="o">=</span> <span class="nx">USD_ETH</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
<span class="nx">price</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span> <span class="o">==</span> <span class="s1">'500.00 USD/ETH'</span><span class="p">;</span>

<span class="c1">// multiplication handles units</span>
<span class="kr">const</span> <span class="nx">usd</span> <span class="o">=</span> <span class="nx">eth</span><span class="p">.</span><span class="nx">times</span><span class="p">(</span><span class="nx">price</span><span class="p">);</span>
<span class="nx">usd</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span> <span class="o">==</span> <span class="s1">'2500.00 USD'</span><span class="p">;</span>

<span class="c1">// division does too</span>
<span class="kr">const</span> <span class="nx">eth2</span> <span class="o">=</span> <span class="nx">usd</span><span class="p">.</span><span class="nx">div</span><span class="p">(</span><span class="nx">eth</span><span class="p">);</span>
<span class="nx">eth2</span><span class="p">.</span><span class="nx">isEqual</span><span class="p">(</span><span class="nx">eth</span><span class="p">);</span>
</code></pre>
<p>Methods that take numerical values as input can also take instances of token
classes that the library provides. These are useful for managing precision,
keeping track of units, and passing in wei values.</p>

<p>Most methods that return numerical values return them wrapped in one of these
classes.</p>

<p>There are two types:</p>

<ul>
<li><strong>currency units</strong>, which represent an amount of a type of currency</li>
<li><strong>price units</strong>, which represent an exchange rate between two currencies.</li>
</ul>

<p>The classes that begin with <code>USD</code> are price units; e.g. <code>USD_ETH</code> represents
the price of ETH in USD.</p>

<p>Useful instance methods:</p>

<ul>
<li><strong>toNumber</strong>: return the raw JavaScript value. This may fail for very large numbers.</li>
<li><strong>toBigNumber</strong>: return the raw value as a <a href="https://github.com/MikeMcl/bignumber.js">BigNumber</a>.</li>
<li><strong>isEqual</strong>: compare the values and symbols of two different instances.</li>
<li><strong>toString</strong>: show the value in human-readable form, e.g. &quot;500 USD/ETH&quot;.</li>
</ul>
<h1 id='cdp'>CDP</h1>
<p>Now that you&#39;ve used <code>maker</code> to either open a new CDP or retrieve an existing one, you can use the returned <code>cdp</code> object to call functions on it.</p>
<h2 id='getid'><strong>getId</strong></h2><pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">cdp</span><span class="p">.</span><span class="nx">getId</span><span class="p">();</span>
</code></pre>
<ul>
<li><strong>Params:</strong> none</li>
<li><strong>Returns:</strong> promise (resolves to CDP ID)</li>
</ul>

<p>Use <code>cdp.getId()</code> to retrieve the ID from a CDP object. You can pass this ID to
<a href="#getcdp"><code>Maker.getCdp</code></a>.</p>
<h2 id='getdebtvalue'><strong>getDebtValue</strong></h2><pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">daiDebt</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">cdp</span><span class="p">.</span><span class="nx">getDebtValue</span><span class="p">();</span>
<span class="kr">const</span> <span class="nx">usdDebt</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">cdp</span><span class="p">.</span><span class="nx">getDebtValue</span><span class="p">(</span><span class="nx">Maker</span><span class="p">.</span><span class="nx">USD</span><span class="p">);</span>
</code></pre>
<ul>
<li><strong>Params:</strong> <a href="#units">currency unit</a> (optional)</li>
<li><strong>Returns:</strong> promise (resolves to the amount of outstanding debt)</li>
</ul>

<p><code>cdp.getDebtValue()</code> returns the amount of that has been borrowed against the collateral in the CDP. By default it returns the amount of Dai as a <a href="#units">currency unit</a>, but can return the equivalent in USD if the first argument is <code>Maker.USD</code>.</p>
<h2 id='getgovernancefee'><strong>getGovernanceFee</strong></h2><pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">mkrFee</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">cdp</span><span class="p">.</span><span class="nx">getGovernanceFee</span><span class="p">();</span>
<span class="kr">const</span> <span class="nx">usdFee</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">cdp</span><span class="p">.</span><span class="nx">getGovernanceFee</span><span class="p">(</span><span class="nx">Maker</span><span class="p">.</span><span class="nx">USD</span><span class="p">);</span>
</code></pre>
<ul>
<li><strong>Params:</strong> <a href="#units">currency unit</a> (optional)</li>
<li><strong>Returns:</strong> promise (resolves to the value of the accrued governance fee in USD)</li>
</ul>

<p><code>cdp.getGovernanceFee()</code> returns the value of the accrued governance fee. By default it returns the amount of MKR as a <a href="#units">currency unit</a>, but can return the equivalent in USD if the first argument is <code>Maker.USD</code>.</p>
<h2 id='getcollateralizationratio'><strong>getCollateralizationRatio</strong></h2><pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">ratio</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">cdp</span><span class="p">.</span><span class="nx">getCollateralizationRatio</span><span class="p">();</span>
</code></pre>
<ul>
<li><strong>Params:</strong> none</li>
<li><strong>Returns:</strong> promise (resolves to the collateralization ratio)</li>
</ul>

<p><code>cdp.getCollateralizationRatio()</code> returns the USD value of the collateral in the CDP divided by the USD value of the Dai debt for the CDP, e.g. <code>2.5</code>.</p>
<h2 id='getliquidationprice'><strong>getLiquidationPrice</strong></h2><pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">ratio</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">cdp</span><span class="p">.</span><span class="nx">getLiquidationPrice</span><span class="p">();</span>
</code></pre>
<ul>
<li><strong>Params:</strong> none</li>
<li><strong>Returns:</strong> promise (resolves to the liquidation price)</li>
</ul>

<p><code>cdp.getLiquidationPrice()</code> returns the price of Ether in USD that causes the CDP to become unsafe (able to be liquidated), all other factors constant. It returns a <code>USD_ETH</code> <a href="#units">price unit</a>.</p>
<h2 id='getcollateralvalue'><strong>getCollateralValue</strong></h2><pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">ethCollateral</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">cdp</span><span class="p">.</span><span class="nx">getCollateralValue</span><span class="p">();</span>
<span class="kr">const</span> <span class="nx">pethCollateral</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">cdp</span><span class="p">.</span><span class="nx">getCollateralValue</span><span class="p">(</span><span class="nx">Maker</span><span class="p">.</span><span class="nx">PETH</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">usdCollateral</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">cdp</span><span class="p">.</span><span class="nx">getCollateralValue</span><span class="p">(</span><span class="nx">Maker</span><span class="p">.</span><span class="nx">USD</span><span class="p">);</span>
</code></pre>
<ul>
<li><strong>Params:</strong> <a href="#units">currency unit</a> (optional)</li>
<li><strong>Returns:</strong> promise (resolves to collateral amount)</li>
</ul>

<p><code>cdp.getCollateralValue()</code> returns the value of the collateral in the CDP. By default it returns the amount of ETH as a <a href="#units">currency unit</a>, but can return the equivalent in PETH or USD depending on the first argument.</p>
<h2 id='issafe'><strong>isSafe</strong></h2><pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">ratio</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">cdp</span><span class="p">.</span><span class="nx">isSafe</span><span class="p">();</span>
</code></pre>
<ul>
<li><strong>Params:</strong> none</li>
<li><strong>Returns:</strong> promise (resolves to boolean)</li>
</ul>

<p><code>cdp.isSafe()</code> returns true if the cdp is safe, that is, if the USD value of its collateral is greater than or equal to USD value of the its debt multiplied by the liquidation ratio.</p>
<h2 id='locketh'><strong>lockEth</strong></h2><pre class="highlight javascript tab-javascript"><code><span class="k">return</span> <span class="nx">await</span> <span class="nx">cdp</span><span class="p">.</span><span class="nx">lockEth</span><span class="p">(</span><span class="mi">10000000000000000000</span><span class="p">,</span> <span class="nx">ETH</span><span class="p">.</span><span class="nx">wei</span><span class="p">);</span>
<span class="c1">// or equivalently</span>
<span class="k">return</span> <span class="nx">await</span> <span class="nx">cdp</span><span class="p">.</span><span class="nx">lockEth</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="nx">ETH</span><span class="p">);</span>
</code></pre>
<ul>
<li><strong>Params:</strong> amount to lock in the CDP, in units defined by the price service.</li>
<li><strong>Returns:</strong> promise (resolves to <a href="#transactions"><code>transactionObject</code></a> once mined)</li>
</ul>

<p><code>cdp.lockEth(eth)</code> abstracts the token conversions needed to lock collateral in a CDP. It first converts the ETH to WETH, then converts the WETH to PETH, then locks the PETH in the CDP.</p>
<h2 id='drawdai'><strong>drawDai</strong></h2><pre class="highlight javascript tab-javascript"><code><span class="k">return</span> <span class="nx">await</span> <span class="nx">cdp</span><span class="p">.</span><span class="nx">drawDai</span><span class="p">(</span><span class="mi">10000000000000000000</span><span class="p">,</span> <span class="nx">DAI</span><span class="p">.</span><span class="nx">wei</span><span class="p">);</span>
<span class="c1">// or equivalently</span>
<span class="k">return</span> <span class="nx">await</span> <span class="nx">cdp</span><span class="p">.</span><span class="nx">drawDai</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="nx">DAI</span><span class="p">);</span>
</code></pre>
<ul>
<li><strong>Params:</strong> amount to draw (in Dai, as string)</li>
<li><strong>Returns:</strong> promise (resolves to <a href="#transactions"><code>transactionObject</code></a> once mined)</li>
</ul>

<p><code>cdp.drawDai(dai)</code> withdraws the specified amount of Dai as a loan against the collateral in the CDP. As such, it will fail if the CDP doesn&#39;t have enough PETH locked in it to remain at least 150% collateralized.</p>
<h2 id='wipedai'><strong>wipeDai</strong></h2><pre class="highlight javascript tab-javascript"><code><span class="k">return</span> <span class="nx">await</span> <span class="nx">cdp</span><span class="p">.</span><span class="nx">wipeDai</span><span class="p">(</span><span class="mi">10000000000000000000</span><span class="p">,</span> <span class="nx">DAI</span><span class="p">.</span><span class="nx">wei</span><span class="p">);</span>
<span class="c1">// or equivalently</span>
<span class="k">return</span> <span class="nx">await</span> <span class="nx">cdp</span><span class="p">.</span><span class="nx">wipeDai</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="nx">DAI</span><span class="p">);</span>
</code></pre>
<ul>
<li><strong>Params:</strong> amount to repay (in Dai, as string)</li>
<li><strong>Returns:</strong> promise (resolves to <a href="#transactions"><code>transactionObject</code></a> once mined)</li>
</ul>

<p><code>cdp.wipeDai(dai)</code> sends Dai back to the CDP in order to repay some (or all) of its outstanding debt.</p>

<p><em>Note: CDPs accumulate MKR governance debt over their lifetime. This must be paid when wiping dai debt, and thus MKR must be acquired before calling this method.</em></p>
<h2 id='freepeth'><strong>freePeth</strong></h2><pre class="highlight javascript tab-javascript"><code><span class="k">return</span> <span class="nx">await</span> <span class="nx">cdp</span><span class="p">.</span><span class="nx">freePeth</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="nx">PETH</span><span class="p">);</span>
<span class="c1">// or equivalently</span>
<span class="k">return</span> <span class="nx">await</span> <span class="nx">cdp</span><span class="p">.</span><span class="nx">freePeth</span><span class="p">(</span><span class="mi">10000000000000000000</span><span class="p">,</span> <span class="nx">PETH</span><span class="p">.</span><span class="nx">wei</span><span class="p">);</span>
</code></pre>
<ul>
<li><strong>Params:</strong> amount of Peth collateral to free from the CDP, in units defined by the price service.</li>
<li><strong>Returns:</strong> promise (resolves to <a href="#transactions"><code>transactionObject</code></a> once mined)</li>
</ul>

<p><code>cdp.freePeth(peth)</code> withdraws the specified amount of PETH and returns it to the owner&#39;s address. As such, the contract will only allow you to free PETH that&#39;s locked in excess of 150% of the CDP&#39;s outstanding debt.</p>
<h2 id='give'><strong>give</strong></h2><pre class="highlight javascript tab-javascript"><code><span class="k">return</span> <span class="nx">await</span> <span class="nx">cdp</span><span class="p">.</span><span class="nx">give</span><span class="p">(</span><span class="s1">'0x046ce6b8ecb159645d3a605051ee37ba93b6efcc'</span><span class="p">);</span>
</code></pre>
<ul>
<li><strong>Params:</strong> Ethereum address (string)</li>
<li><strong>Returns:</strong> promise (resolves to <a href="#transactions"><code>transactionObject</code></a> once mined)</li>
</ul>

<p><code>cdp.give(address)</code> transfers ownership of the CDP from the current owner to the address you provide as an argument.</p>
<h2 id='shut'><strong>shut</strong></h2><pre class="highlight javascript tab-javascript"><code><span class="k">return</span> <span class="nx">await</span> <span class="nx">cdp</span><span class="p">.</span><span class="nx">shut</span><span class="p">();</span>
</code></pre>
<ul>
<li><strong>Params:</strong> none</li>
<li><strong>Returns:</strong> promise (resolves to <a href="#transactions"><code>transactionObject</code></a> once mined)</li>
</ul>

<p><code>cdp.shut()</code> wipes all remaining dai, frees all remaining collateral, and deletes the CDP. This will fail if the caller does not have enough DAI and MKR to wipe all debt.</p>
<h2 id='bite'><strong>bite</strong></h2><pre class="highlight javascript tab-javascript"><code><span class="k">return</span> <span class="nx">await</span> <span class="nx">cdp</span><span class="p">.</span><span class="nx">bite</span><span class="p">();</span>
</code></pre>
<ul>
<li><strong>Params:</strong> none</li>
<li><strong>Returns:</strong> promise (resolves to <a href="#transactions"><code>transactionObject</code></a> once mined)</li>
</ul>

<p><code>cdp.bite()</code> will initiate the liquidation process of an undercollateralized CDP</p>
<h1 id='price-service'>Price Service</h1><pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">price</span> <span class="o">=</span> <span class="nx">maker</span><span class="p">.</span><span class="nx">service</span><span class="p">(</span><span class="s1">'price'</span><span class="p">);</span>
</code></pre>
<p>Retrieve the PriceService through <code>Maker.service(&#39;price&#39;)</code>.</p>

<p>The PriceService exposes the collateral and governance tokens&#39; price information that is
reported by the oracles in the Maker system.</p>
<h2 id='getethprice'>getEthPrice</h2><pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">ethPrice</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">price</span><span class="p">.</span><span class="nx">getEthPrice</span><span class="p">();</span>
</code></pre>
<p>Get the current USD price of ETH, as a <code>USD_ETH</code> <a href="#units">price unit</a>.</p>
<h2 id='getmkrprice'>getMkrPrice</h2><pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">mkrPrice</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">price</span><span class="p">.</span><span class="nx">getMkrPrice</span><span class="p">();</span>
</code></pre>
<p>Get the current USD price of the governance token MKR, as a <code>USD_MKR</code> <a href="#units">price unit</a>.</p>
<h2 id='getpethprice'>getPethPrice</h2><pre class="highlight javascript tab-javascript"><code><span class="nx">await</span> <span class="nx">pethPrice</span> <span class="o">=</span> <span class="nx">price</span><span class="p">.</span><span class="nx">getPethPrice</span><span class="p">();</span>
</code></pre>
<p>Get the current USD price of PETH (pooled ethereum), as a <code>USD_PETH</code> <a href="#units">price unit</a>.</p>
<h2 id='setethprice'>setEthPrice</h2><pre class="highlight javascript tab-javascript"><code><span class="nx">await</span> <span class="nx">price</span><span class="p">.</span><span class="nx">setEthPrice</span><span class="p">(</span><span class="mi">475</span><span class="p">);</span>
</code></pre>
<p>Set the current USD price of ETH.</p>

<p>This requires the necessary permissions and will only be useful in a testing environment.</p>
<h2 id='setmkrprice'>setMkrPrice</h2><pre class="highlight javascript tab-javascript"><code><span class="nx">await</span> <span class="nx">price</span><span class="p">.</span><span class="nx">setMkrPrice</span><span class="p">(</span><span class="mf">950.00</span><span class="p">);</span>
</code></pre>
<p>Set the current USD price of the governance token MKR.</p>

<p>This requires the necessary permissions and will only be useful in a testing environment.</p>
<h2 id='getwethtopethratio'>getWethToPethRatio</h2><pre class="highlight javascript tab-javascript"><code><span class="nx">await</span> <span class="nx">price</span><span class="p">.</span><span class="nx">getWethToPethRatio</span><span class="p">();</span>
</code></pre>
<p>Returns the current W-ETH to PETH ratio.</p>
<h1 id='eth-cdp-service'>ETH CDP Service</h1><pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">ethCdp</span> <span class="o">=</span> <span class="nx">maker</span><span class="p">.</span><span class="nx">service</span><span class="p">(</span><span class="s1">'cdp'</span><span class="p">);</span>
</code></pre>
<p>Retrieve the ETH CDP Service through Maker.service(&#39;cdp&#39;).</p>

<p>The ETH CDP Service exposes the risk parameter information for the Ether CDP type (in single-collateral Dai, this is the only CDP Type)</p>
<h2 id='getliquidationratio'><strong>getLiquidationRatio</strong></h2><pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">ratio</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">ethCdp</span><span class="p">.</span><span class="nx">getLiquidationRatio</span><span class="p">();</span>
</code></pre>
<ul>
<li><strong>Params:</strong> none</li>
<li><strong>Returns:</strong> promise (resolves to liquidation ratio)</li>
</ul>

<p><code>getLiquidationPenalty()</code> returns a decimal representation of the liquidation penalty, e.g. 1.5</p>
<h2 id='getliquidationpenalty'><strong>getLiquidationPenalty</strong></h2><pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">penalty</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">ethCdp</span><span class="p">.</span><span class="nx">getLiquidationPenalty</span><span class="p">();</span>
</code></pre>
<ul>
<li><strong>Params:</strong> none</li>
<li><strong>Returns:</strong> promise (resolves to liquidation penalty)</li>
</ul>

<p><code>getLiquidationPenalty()</code> returns a decimal representation of the liquidation penalty, e.g. 0.13</p>
<h2 id='getannualgovernancefee'><strong>getAnnualGovernanceFee</strong></h2><pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">fee</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">ethCdp</span><span class="p">.</span><span class="nx">getAnnualGovernanceFee</span><span class="p">();</span>
</code></pre>
<ul>
<li><strong>Params:</strong> none</li>
<li><strong>Returns:</strong> promise (resolves to yearly governance fee)</li>
</ul>

<p><code>getAnnualGovernanceFee()</code> returns a decimal representation of the liquidation penalty, e.g. 0.005</p>
<h1 id='exchange-service'>Exchange Service</h1><pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">exchange</span> <span class="o">=</span> <span class="nx">maker</span><span class="p">.</span><span class="nx">service</span><span class="p">(</span><span class="s1">'exchange'</span><span class="p">);</span>
</code></pre>
<p>Retrieve the OasisExchangeService (or alternative implementation) 
through <code>Maker.service(&#39;exchange&#39;)</code>.</p>

<p>The exchange service allows to buy and sell DAI, MKR, and other tokens. The default 
OasisExchangeService implementation uses the OasisDEX OTC market for this.</p>
<h2 id='selldai'>sellDai</h2><pre class="highlight javascript tab-javascript"><code><span class="c1">// Sell 100.00 DAI for 0.30 WETH or more.</span>
<span class="kr">const</span> <span class="nx">sellOrder</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">exchange</span><span class="p">.</span><span class="nx">sellDai</span><span class="p">(</span><span class="s1">'100.0'</span><span class="p">,</span> <span class="s1">'WETH'</span><span class="p">,</span> <span class="s1">'0.30'</span><span class="p">);</span>
</code></pre>
<p>Sell a set amount of DAI and receive another token in return.</p>

<ul>
<li><strong>Parameters</strong>

<ul>
<li><code>daiAmount</code> - Amount of DAI to sell.</li>
<li><code>tokenSymbol</code> - Token to receive in return.</li>
<li><code>minFillAmount</code> - Minimum amount to receive in return.</li>
</ul></li>
<li><strong>Returns:</strong> promise (resolves to OasisOrder once mined)</li>
</ul>
<h2 id='buydai'>buyDai</h2><pre class="highlight javascript tab-javascript"><code><span class="c1">// Buy 100.00 DAI for 0.30 WETH or less.</span>
<span class="kr">const</span> <span class="nx">buyOrder</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">exchange</span><span class="p">.</span><span class="nx">buyDai</span><span class="p">(</span><span class="s1">'100.0'</span><span class="p">,</span> <span class="s1">'WETH'</span><span class="p">,</span> <span class="s1">'0.35'</span><span class="p">);</span>
</code></pre>
<p>Buy a set amount of DAI and give another token in return.</p>

<ul>
<li><strong>Parameters</strong>

<ul>
<li><code>daiAmount</code> - Amount of DAI to buy.</li>
<li><code>tokenSymbol</code> - Token to give in return.</li>
<li><code>minFillAmount</code> - Maximum amount to give in return.</li>
</ul></li>
<li><strong>Returns:</strong> promise (resolves to OasisOrder once mined)</li>
</ul>
<h2 id='oasisorder'>OasisOrder</h2><pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">buyOrder</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">exchange</span><span class="p">.</span><span class="nx">buyDai</span><span class="p">(</span><span class="s1">'100.0'</span><span class="p">,</span> <span class="s1">'WETH'</span><span class="p">,</span> <span class="s1">'0.35'</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">fillAmount</span> <span class="o">=</span> <span class="nx">buyOrder</span><span class="p">.</span><span class="nx">fillAmount</span><span class="p">();</span>
<span class="kr">const</span> <span class="nx">gasPaid</span> <span class="o">=</span> <span class="nx">buyOrder</span><span class="p">.</span><span class="nx">fees</span><span class="p">();</span>
<span class="kr">const</span> <span class="nx">created</span> <span class="o">=</span> <span class="nx">buyOrder</span><span class="p">.</span><span class="nx">created</span><span class="p">();</span>
</code></pre>
<p><code>OasisOrders</code> have a few methods:
    * <code>fillAmount</code>: amount of token received in exchange
    * <code>fees()</code>: amount of ether spent on gas
    * <code>created()</code>: timestamp of when transaction was mined</p>
<h1 id='system-status'>System Status</h1><pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">ethCdp</span> <span class="o">=</span> <span class="nx">maker</span><span class="p">.</span><span class="nx">service</span><span class="p">(</span><span class="s1">'cdp'</span><span class="p">);</span>
</code></pre>
<p>To access system status information, retrieve the ETH CDP Service through Maker.service(&#39;cdp&#39;).</p>
<h2 id='getsystemcollateralization'><strong>getSystemCollateralization</strong></h2><pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">systemRatio</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">ethCdp</span><span class="p">.</span><span class="nx">getSystemCollateralization</span><span class="p">();</span>
</code></pre>
<ul>
<li><strong>Params:</strong> none</li>
<li><strong>Returns:</strong> promise (resolves to system collateralization ratio)</li>
</ul>

<p><code>getSystemCollateralization()</code> returns the collateralization ratio for the entire system, e.g. 2.75</p>
<h2 id='gettargetprice'><strong>getTargetPrice</strong></h2><pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">targetPrice</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">ethCdp</span><span class="p">.</span><span class="nx">getTargetPrice</span><span class="p">();</span>
</code></pre>
<ul>
<li><strong>Params:</strong> none</li>
<li><strong>Returns:</strong> promise (resolves to target price)</li>
</ul>

<p><code>getTargetPrice()</code> returns the target price of Dai in USD, that is, the value to which Dai is soft-pegged, e.g. 1.0</p>
<h1 id='events'>Events</h1>
<p>The event pipeline allows developers to easily create real-time applications by letting them listen for important state changes and lifecycle events.</p>
<h3 id='wildcards'>Wildcards</h3>
<p>An event name passed to any event emitter method can contain a wildcard (the <code>*</code> character). A wildcard may appear as <code>foo/*</code>, <code>foo/bar/*</code>, or simply <code>*</code>.</p>

<p><code>*</code> matches one sub-level.</p>

<p>e.g. <code>price/*</code> will trigger on both <code>price/USD_ETH</code> and <code>price/MKR_USD</code> but not <code>price/MKR_USD/foo</code>.</p>

<p><code>**</code> matches all sub-levels.</p>

<p>e.g. <code>price/**</code> will trigger on <code>price/USD_ETH</code>, <code>price/MKR_USD</code>, and <code>price/MKR_USD/foo</code>.</p>
<h3 id='event-object'>Event Object</h3><pre class="highlight javascript tab-javascript"><code><span class="p">{</span>
    <span class="nl">type</span><span class="p">:</span> <span class="o">&lt;</span><span class="nx">event_type</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="nx">payload</span><span class="p">:</span> <span class="o">&lt;</span><span class="nx">event_payload</span><span class="o">&gt;</span><span class="p">,</span> <span class="cm">/* if applicable */</span>
    <span class="nx">index</span><span class="p">:</span> <span class="o">&lt;</span><span class="nx">event_sequence_number</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="nx">block</span><span class="p">:</span> <span class="o">&lt;</span><span class="nx">latest_block_when_emitted</span><span class="o">&gt;</span>
<span class="p">}</span>
</code></pre>
<p>Triggered events will receive the object shown on the right.</p>

<ul>
<li><code>&lt;event_type&gt;</code> - the name of the event</li>
<li><code>&lt;event_payload&gt;</code> - the new state data sent with the event</li>
<li><code>&lt;event_sequence_number&gt;</code> - a sequentially increasing index</li>
<li><code>&lt;latest_block_when_emitted&gt;</code> - the current block at the time of the emit</li>
</ul>
<h2 id='maker-object'>Maker Object</h2><h3 id='price'><code>Price</code></h3><pre class="highlight javascript tab-javascript"><code><span class="nx">maker</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'price/ETH_USD'</span><span class="p">,</span> <span class="nx">eventObj</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="p">{</span> <span class="nx">price</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">eventObj</span><span class="p">.</span><span class="nx">payload</span><span class="p">;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'ETH price changed to'</span><span class="p">,</span> <span class="nx">price</span><span class="p">);</span>
<span class="p">})</span>
</code></pre>
<table><thead>
<tr>
<th>Event Name</th>
<th>Payload</th>
</tr>
</thead><tbody>
<tr>
<td><code>price/ETH_USD</code></td>
<td>{ price }</td>
</tr>
<tr>
<td><code>price/MKR_USD</code></td>
<td>{ price }</td>
</tr>
<tr>
<td><code>price/WETH_PETH</code></td>
<td>{ ratio }</td>
</tr>
</tbody></table>
<h3 id='web3'><code>Web3</code></h3><pre class="highlight javascript tab-javascript"><code><span class="nx">maker</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'web3/AUTHENTICATED'</span><span class="p">,</span> <span class="nx">eventObj</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="p">{</span> <span class="nx">account</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">eventObj</span><span class="p">.</span><span class="nx">payload</span><span class="p">;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'web3 authenticated with account'</span><span class="p">,</span> <span class="nx">account</span><span class="p">);</span>
<span class="p">})</span>
</code></pre>
<table><thead>
<tr>
<th>Event Name</th>
<th>Payload</th>
</tr>
</thead><tbody>
<tr>
<td><code>web3/INITIALIZED</code></td>
<td>{ provider: { type, url } }</td>
</tr>
<tr>
<td><code>web3/CONNECTED</code></td>
<td>{ api, network, node }</td>
</tr>
<tr>
<td><code>web3/AUTHENTICATED</code></td>
<td>{ account }</td>
</tr>
<tr>
<td><code>web3/DEAUTHENTICATED</code></td>
<td>{ }</td>
</tr>
<tr>
<td><code>web3/DISCONNECTED</code></td>
<td>{ }</td>
</tr>
</tbody></table>
<h2 id='cdp-object'>CDP Object</h2><pre class="highlight javascript tab-javascript"><code><span class="nx">cdp</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'DEBT'</span><span class="p">,</span> <span class="nx">eventObj</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="p">{</span> <span class="nx">dai</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">eventObj</span><span class="p">.</span><span class="nx">payload</span><span class="p">;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Your cdp now has a dai debt of'</span><span class="p">,</span> <span class="nx">dai</span><span class="p">);</span>
<span class="p">})</span>
</code></pre>
<table><thead>
<tr>
<th>Event Name</th>
<th>Payload</th>
</tr>
</thead><tbody>
<tr>
<td><code>COLLATERAL</code></td>
<td>{ USD, ETH }</td>
</tr>
<tr>
<td><code>DEBT</code></td>
<td>{ dai }</td>
</tr>
</tbody></table>
<h1 id='transactions'>Transactions</h1><h3 id='transactionobject-lifecycle-hooks'>TransactionObject Lifecycle Hooks</h3><pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">txObject</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">cdp</span><span class="p">.</span><span class="nx">wipeDai</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="c1">// the transaction is being sent to the blockchain;</span>
<span class="c1">// if not already pending, it will be pending soon</span>

<span class="nx">txObject</span><span class="p">.</span><span class="nx">onPending</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'pending!'</span><span class="p">));</span>
<span class="nx">txObject</span><span class="p">.</span><span class="nx">onMined</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'mined!'</span><span class="p">));</span>
<span class="nx">txObject</span><span class="p">.</span><span class="nx">onFinalized</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'finalized!'</span><span class="p">));</span>
<span class="nx">txObject</span><span class="p">.</span><span class="nx">onError</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'error'</span><span class="p">));</span>

<span class="kr">const</span> <span class="nx">pending</span> <span class="o">=</span> <span class="nx">txObject</span><span class="p">.</span><span class="nx">isPending</span><span class="p">();</span>
<span class="kr">const</span> <span class="nx">mined</span> <span class="o">=</span> <span class="nx">txObject</span><span class="p">.</span><span class="nx">isPending</span><span class="p">();</span>
<span class="kr">const</span> <span class="nx">finalized</span> <span class="o">=</span> <span class="nx">txObject</span><span class="p">.</span><span class="nx">isFinalized</span><span class="p">();</span>
<span class="kr">const</span> <span class="nx">error</span> <span class="o">=</span> <span class="nx">txObject</span><span class="p">.</span><span class="nx">isError</span><span class="p">();</span>

<span class="c1">// if you are using the onFinalized callback, you have to</span>
<span class="c1">// call this method at some point.</span>
<span class="nx">await</span> <span class="nx">txObject</span><span class="p">.</span><span class="nx">confirm</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
<span class="c1">// 5 = the number of blocks to wait; the default is 3</span>

<span class="c1">// now there are five new blocks after the transaction's block</span>
<span class="c1">// and the onFinalized callback has been called</span>
</code></pre>
<p><code>TransactionObjects</code> have methods which can be used to trigger
callbacks when the transaction is pending, or after a certain number of new
blocks have been added after the block containing the transaction (when the
transaction is &quot;finalized&quot;).</p>
<h3 id='transactionobject-transaction-data'>TransactionObject Transaction Data</h3><pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">txObject</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">cdp</span><span class="p">.</span><span class="nx">drawDai</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">hash</span> <span class="o">=</span> <span class="nx">txObject</span><span class="p">.</span><span class="nx">hash</span><span class="p">();</span>
<span class="kr">const</span> <span class="nx">fees</span> <span class="o">=</span> <span class="nx">txObject</span><span class="p">.</span><span class="nx">fees</span><span class="p">();</span>
<span class="kr">const</span> <span class="nx">timeStamp</span> <span class="o">=</span> <span class="nx">txObject</span><span class="p">.</span><span class="nx">timeStamp</span><span class="p">();</span>
<span class="kr">const</span> <span class="nx">timeStampSubmitted</span> <span class="o">=</span> <span class="nx">txObject</span><span class="p">.</span><span class="nx">timeStampSubmitted</span><span class="p">();</span>
</code></pre>
<p><code>TransactionObjects</code> also have a few methods to provide details on the transaction:
    * <code>hash</code>: transaction hash
    * <code>fees()</code>: amount of ether spent on gas
    * <code>timeStamp()</code>: timestamp of when transaction was mined
    * <code>timeStampSubmitted()</code>: timestamp of when transaction was submitted to the network</p>
<h3 id='onnewtransaction'>onNewTransaction</h3><pre class="highlight javascript tab-javascript"><code><span class="nx">maker</span><span class="p">.</span><span class="nx">service</span><span class="p">(</span><span class="s1">'transactionManager'</span><span class="p">).</span><span class="nx">onNewTransaction</span><span class="p">(</span><span class="nx">tx</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">tx</span><span class="p">.</span><span class="nx">onPending</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">tx</span><span class="p">.</span><span class="nx">metadata</span><span class="p">.</span><span class="nx">contract</span><span class="p">}</span><span class="s2">.</span><span class="p">${</span><span class="nx">tx</span><span class="p">.</span><span class="nx">metadata</span><span class="p">.</span><span class="nx">method</span><span class="p">}</span><span class="s2">: pending`</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">});</span>
</code></pre>
<p>The <code>onNewTransaction</code> function in the <code>transactionManager</code> service allows you to register a callback that gets called every time a transaction is initiated by the dai.js library.</p>
<h1 id='using-multiple-accounts'>Using Multiple Accounts</h1><pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">maker</span> <span class="o">=</span> <span class="nx">Maker</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
  <span class="na">url</span><span class="p">:</span> <span class="s1">'http://localhost:2000'</span><span class="p">,</span>
  <span class="na">accounts</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">other</span><span class="p">:</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="nx">privateKey</span><span class="p">,</span> <span class="na">key</span><span class="p">:</span> <span class="nx">someOtherKey</span><span class="p">},</span>
    <span class="na">default</span><span class="p">:</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="nx">privateKey</span><span class="p">,</span> <span class="na">key</span><span class="p">:</span> <span class="nx">myKey</span><span class="p">}</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="nx">await</span> <span class="nx">maker</span><span class="p">.</span><span class="nx">authenticate</span><span class="p">();</span>
<span class="nx">await</span> <span class="nx">maker</span><span class="p">.</span><span class="nx">addAccount</span><span class="p">(</span><span class="s1">'yetAnother'</span><span class="p">,</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="nx">privateKey</span><span class="p">,</span> <span class="na">key</span><span class="p">:</span> <span class="nx">thirdKey</span><span class="p">});</span>

<span class="kr">const</span> <span class="nx">cdp1</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">maker</span><span class="p">.</span><span class="nx">openCdp</span><span class="p">();</span> <span class="c1">// owned by "default"</span>

<span class="nx">maker</span><span class="p">.</span><span class="nx">useAccount</span><span class="p">(</span><span class="s1">'other'</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">cdp2</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">maker</span><span class="p">.</span><span class="nx">openCdp</span><span class="p">();</span> <span class="c1">// owned by "other"</span>

<span class="nx">maker</span><span class="p">.</span><span class="nx">useAccount</span><span class="p">(</span><span class="s1">'yetAnother'</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">cdp3</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">maker</span><span class="p">.</span><span class="nx">openCdp</span><span class="p">();</span> <span class="c1">// owned by "yetAnother"</span>
</code></pre>
<p>The library supports the use of multiple accounts (i.e. private keys) within a single Maker instance. Accounts can be specified in the constructor options or with the <code>addAccount</code> method.</p>

<p>Call <code>useAccount</code> to switch to using an account by its name, and subsequent calls will use that account as the transaction signer.</p>

<p>When the Maker instance is first created, it will use the account named <code>default</code> if it exists, or the first account in the list otherwise.</p>
<h2 id='account-types'>Account types</h2><pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">maker</span> <span class="o">=</span> <span class="nx">Maker</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
  <span class="na">url</span><span class="p">:</span> <span class="s1">'http://localhost:2000'</span><span class="p">,</span>
  <span class="na">accounts</span><span class="p">:</span> <span class="p">{</span>
    <span class="c1">// this will be the first account from the provider at</span>
    <span class="c1">// localhost:2000</span>
    <span class="na">first</span><span class="p">:</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="s1">'provider'</span><span class="p">},</span>

    <span class="c1">// this will be the current account in MetaMask, and it</span>
    <span class="c1">// will send its transactions through MetaMask</span>
    <span class="na">second</span><span class="p">:</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="s1">'browser'</span><span class="p">},</span>

    <span class="c1">// this account will send its transactions through the</span>
    <span class="c1">// provider at localhost:2000</span>
    <span class="na">third</span><span class="p">:</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="s1">'privateKey'</span><span class="p">,</span> <span class="na">key</span><span class="p">:</span> <span class="nx">myPrivateKey</span><span class="p">}</span>
  <span class="p">}</span>
<span class="p">})</span>
</code></pre>
<p>In addition to the <code>privateKey</code> account type, there are two other built-in types:</p>

<ul>
<li><code>provider</code>: Get the first account from the provider (e.g. the value from <code>getAccounts</code>).</li>
<li><code>browser</code>: Get the first account from the provider in the browser (e.g. MetaMask), even if the Maker instance is configured to use a different provider.</li>
</ul>
<h2 id='plugins'>Plugins</h2><pre class="highlight javascript tab-javascript"><code><span class="kr">import</span> <span class="nx">TrezorPlugin</span> <span class="nx">from</span> <span class="s1">'@makerdao/dai-plugin-trezor-web'</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">LedgerPlugin</span> <span class="nx">from</span> <span class="s1">'@makerdao/dai-plugin-ledger-web'</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">maker</span> <span class="o">=</span> <span class="nx">Maker</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
  <span class="na">plugins</span><span class="p">:</span> <span class="p">[</span>
    <span class="nx">TrezorPlugin</span><span class="p">,</span>
    <span class="nx">LedgerPlugin</span><span class="p">,</span>
  <span class="p">],</span>
  <span class="na">accounts</span><span class="p">:</span> <span class="p">{</span>
    <span class="c1">// default derivation path is "44'/60'/0'/0/0"</span>
    <span class="na">myTrezor</span><span class="p">:</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="s1">'trezor'</span><span class="p">,</span> <span class="na">path</span><span class="p">:</span> <span class="nx">derivationPath1</span><span class="p">},</span>
    <span class="na">myLedger</span><span class="p">:</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="s1">'ledger'</span><span class="p">,</span> <span class="na">path</span><span class="p">:</span> <span class="nx">derivationPath2</span><span class="p">}</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre>
<p>Plugins can add additional account types. There are currently two such plugins for hardware wallet support:</p>

<ul>
<li><a href="https://github.com/makerdao/dai-plugin-trezor-web">dai-plugin-trezor-web</a></li>
<li><a href="https://github.com/makerdao/dai-plugin-ledger-web">dai-plugin-ledger-web</a></li>
</ul>
<h2 id='demo'>Demo</h2>
<p>Install the <a href="https://github.com/makerdao/integration-examples/tree/master/accounts">multiple accounts demo app</a> to see this functionality in action.</p>
<h1 id='developing'>Developing</h1>
<ol>
<li><code>git clone https://github.com/makerdao/makerdao-integration-poc</code></li>
<li><code>npm install</code></li>
</ol>
<h2 id='running-the-tests'>Running the tests</h2>
<p>The test suite is configured to run on a Ganache test chain.</p>

<p>If you run the tests with <code>npm test</code>, it will start a test chain and deploy
all the smart contracts for the Dai stablecoin system. This takes a few minutes.</p>

<p>To keep the test chain running and re-run the tests when changes are made to the
code, use the command <code>npm run test:watch</code>.</p>

<p>If you want to deploy the contracts to a test chain without running the test
suite, use <code>npm run test:net</code>.</p>
<h2 id='inspect-contract-state'>Inspect contract state</h2>
<p>Start the dev server using <code>npm start</code>, then open
<a href="http://localhost:9000">http://localhost:9000</a>.</p>
<h2 id='commands'>Commands</h2>
<ul>
<li><code>npm start</code> - start the dev server</li>
<li><code>npm run build:backend</code> - create backend build in <code>dist</code> folder</li>
<li><code>npm run build:frontend</code> - create frontend build in <code>dist</code> folder</li>
<li><code>npm run lint</code> - run an ESLint check</li>
<li><code>npm run coverage</code> - run code coverage and generate report in the <code>coverage</code> folder</li>
<li><code>npm test</code> - run all tests</li>
<li><code>npm run test:watch</code> - run all tests in watch mode</li>
<li><code>npm run test:net</code> - launch a Ganache test chain and deploy MakerDAO&#39;s contracts on it</li>
</ul>
<h1 id='adding-a-new-service'>Adding a New Service</h1>
<p><em>Note: This section is only for advanced users that are willing to modify the dai.js source code.  In the future, you will be able to add custom services without needing to modify the source code.</em></p>

<p>You can take advantage of the pluggable architecture of this library by choosing different implementations for services, and/or adding new service roles altogether.  A service is just a Javascript class that inherits from either <code>PublicService</code>, <code>PrivateService</code>, or <code>LocalService</code>, and contains public method(s).  It can depend on other services through a built-in dependency injection framework, and can also be configured through the Maker config file / config options.</p>
<h2 id='steps-to-add-a-new-service'>Steps to add a new service</h2>
<p>Here are the steps to add a new service called <code>ExampleService</code> to MakerJS:</p>

<ul>
<li><p>(1) In the <code>src</code> directory, create an <code>ExampleService.js</code> file in one of the subdirectories.</p></li>
<li><p>(2) In <code>src/config/DefaultServiceProvider.js</code>, import <code>ExampleService.js</code> and add it to the <code>_services</code> array</p></li>
<li><p>(3) Create a class called <code>ExampleService</code> in <code>ExampleService.js</code></p></li>
</ul>
<pre class="highlight javascript tab-javascript"><code><span class="c1">//example code in ExampleService.js for steps 3-6</span>
<span class="kr">import</span> <span class="nx">PublicService</span> <span class="nx">from</span> <span class="s1">'../core/PublicService'</span><span class="p">;</span>

<span class="kr">export</span> <span class="k">default</span> <span class="kr">class</span> <span class="nx">ExampleService</span> <span class="kr">extends</span> <span class="nx">PublicService</span> <span class="p">{</span>
    <span class="nx">constructor</span> <span class="p">(</span><span class="nx">name</span><span class="o">=</span><span class="s1">'example'</span><span class="p">)</span> <span class="p">{</span>
        <span class="kr">super</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="p">[</span><span class="s1">'log'</span><span class="p">]);</span>
    <span class="p">}</span>

    <span class="nx">test</span><span class="p">(){</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'log'</span><span class="p">).</span><span class="nx">info</span><span class="p">(</span><span class="s1">'test'</span><span class="p">);</span>
    <span class="p">}</span>
</code></pre>
<ul>
<li><p>(4) The service must <code>extend</code> one of:</p>

<ul>
<li><code>PrivateService</code> - requires both a network connection and authentication</li>
<li><code>PublicService</code> - requires just a network connection</li>
<li><code>LocalService</code> - requires neither</li>
</ul>

<p>See the <code>Service Lifecycle</code> section below for more info</p></li>
<li><p>(5) In the constructor, call the parent class&#39;s constructor with the following arguments:</p>

<ul>
<li>The name of the service.  This is how the service can be referenced by other services</li>
<li>An array of the names of services to depend on</li>
</ul></li>
<li><p>(6) Add the necessary public methods</p></li>
</ul>
<pre class="highlight javascript tab-javascript"><code><span class="c1">//example code in ExampleService.spec.js for step 8</span>
<span class="kr">import</span> <span class="nx">Maker</span> <span class="nx">from</span> <span class="s1">'../../src/index'</span><span class="p">;</span>

<span class="c1">//step 8: a new service role ('example') is used</span>
<span class="nx">test</span><span class="p">(</span><span class="s1">'test 1'</span><span class="p">,</span> <span class="nx">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">maker</span> <span class="o">=</span> <span class="nx">Maker</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s1">'http'</span><span class="p">,</span> <span class="p">{</span><span class="na">example</span><span class="p">:</span> <span class="s2">"ExampleService"</span><span class="p">});</span>
  <span class="kr">const</span> <span class="nx">exampleService</span> <span class="o">=</span> <span class="nx">customMaker</span><span class="p">.</span><span class="nx">service</span><span class="p">(</span><span class="s1">'example'</span><span class="p">);</span>
  <span class="nx">exampleService</span><span class="p">.</span><span class="nx">test</span><span class="p">();</span> <span class="c1">//logs "test"</span>
<span class="p">});</span>

<span class="c1">//step 8: a custom service replaces a default service (Web3)</span>
<span class="nx">test</span><span class="p">(</span><span class="s1">'test 2'</span><span class="p">,</span> <span class="nx">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">maker</span> <span class="o">=</span> <span class="nx">Maker</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s1">'http'</span><span class="p">,</span> <span class="p">{</span><span class="na">web3</span><span class="p">:</span> <span class="s2">"MyCustomWeb3Service"</span><span class="p">});</span>
  <span class="kr">const</span> <span class="nx">mycustomWeb3Service</span> <span class="o">=</span> <span class="nx">maker</span><span class="p">.</span><span class="nx">service</span><span class="p">(</span><span class="s1">'web3'</span><span class="p">);</span>
<span class="p">});</span>
</code></pre>
<ul>
<li><p>(7) If your service will be used to replace a default service (the full list of default service roles can be found in <code>src/config/ConfigFactory</code>),  then skip this step.  Otherwise, you&#39;ll need to add your new service role (e.g. <code>&quot;example&quot;</code>) to the <code>ServiceRoles</code> array in <code>src/config/ConfigFactory</code>.</p></li>
<li><p>(8) Create a corresponding <code>ExampleService.spec.js</code> file in the <code>test</code> directory.  Write a test in the test file that creates a Maker object using your service.</p></li>
<li><p>(9) (Optional) Implement the relevant service lifecycle functions (<code>initialize()</code>, <code>connect()</code>, and <code>authenticate()</code>).  See the <code>Service Lifecycle</code> section below for more info</p></li>
</ul>
<pre class="highlight javascript tab-javascript"><code><span class="c1">//step 10: in ExampleService.spec.js</span>
<span class="kr">const</span> <span class="nx">maker</span> <span class="o">=</span> <span class="nx">Maker</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s1">'http'</span><span class="p">,</span> <span class="p">{</span><span class="na">example</span><span class="p">:</span> <span class="p">[</span><span class="s2">"ExampleService"</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">exampleSetting</span><span class="p">:</span> <span class="s2">"this is a configuration setting"</span>
  <span class="p">}]});</span>

<span class="c1">//step 10: accessing configuration settings in ExampleService.js</span>
<span class="nx">initialize</span><span class="p">(</span><span class="nx">settings</span><span class="p">){</span>
  <span class="k">if</span><span class="p">(</span><span class="nx">settings</span><span class="p">.</span><span class="nx">exampleSetting</span><span class="p">){</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'log'</span><span class="p">).</span><span class="nx">info</span><span class="p">(</span><span class="nx">settings</span><span class="p">.</span><span class="nx">exampleSetting</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<ul>
<li>(10) (Optional) Allow for configuration.  Service-specific settings can be passed into a service by the Maker config file or config options.  These service-specific settings can then be accessed from inside a service as the parameter passed into the <code>initialize</code> function (see the <code>Service Lifecycle</code> section below)</li>
</ul>
<h2 id='service-lifecycle'>Service Lifecycle</h2>
<p>The three kinds of services mentioned in step 4 above follow the following state machine diagrams in the picture below.</p>
<pre class="highlight javascript tab-javascript"><code><span class="c1">//example initialize() function in ExampleService.js</span>
  <span class="nx">initialize</span><span class="p">(</span><span class="nx">settings</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'log'</span><span class="p">).</span><span class="nx">info</span><span class="p">(</span><span class="s1">'ExampleService is initializing...'</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_setSettings</span><span class="p">(</span><span class="nx">settings</span><span class="p">);</span>
  <span class="p">}</span>
</code></pre>
<p>To specify what initializing, connecting and authenticating entails, implement the <code>initialize()</code>, <code>connect()</code>, and <code>authenticate()</code> functions in the service itself.  This will be called while the service&#39;s manager brings the service to the corresponding state.</p>

<p><img src="images/statemachine.png" alt="alt text" /></p>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">maker</span> <span class="o">=</span> <span class="nx">Maker</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s1">'http'</span><span class="p">,</span> <span class="p">{</span><span class="na">example</span><span class="p">:</span> <span class="s2">"ExampleService"</span><span class="p">});</span>
<span class="kr">const</span> <span class="nx">exampleService</span> <span class="o">=</span> <span class="nx">customMaker</span><span class="p">.</span><span class="nx">service</span><span class="p">(</span><span class="s1">'example'</span><span class="p">);</span>

<span class="c1">//wait for example service and its dependencies to initialize</span>
<span class="nx">await</span> <span class="nx">exampleService</span><span class="p">.</span><span class="nx">manager</span><span class="p">().</span><span class="nx">initialize</span><span class="p">();</span>

<span class="c1">//wait for example service and its dependencies to connect</span>
<span class="nx">await</span> <span class="nx">exampleService</span><span class="p">.</span><span class="nx">manager</span><span class="p">().</span><span class="nx">connect</span><span class="p">();</span>

<span class="c1">//wait for example service and its dependencies to authenticate</span>
<span class="nx">await</span> <span class="nx">exampleService</span><span class="p">.</span><span class="nx">manager</span><span class="p">().</span><span class="nx">authenticate</span><span class="p">();</span>

<span class="c1">//can also use callback syntax</span>
<span class="nx">exampleService</span><span class="p">.</span><span class="nx">manager</span><span class="p">().</span><span class="nx">onConnected</span><span class="p">(()</span><span class="o">=&gt;</span><span class="p">{</span>
    <span class="cm">/*executed after connected*/</span>
<span class="p">});</span>

<span class="c1">//wait for all services used by the maker object to authenticate</span>
<span class="nx">maker</span><span class="p">.</span><span class="nx">authenticate</span><span class="p">();</span>
</code></pre>
<p>A service will not finish initializing/connecting/authenticating until all of its dependent services have completed the same state (if applicable - for example a <code>LocalService</code> is considered authenticated/connected in addition to initialized, if it has finished initializing).  The example code here shows how to wait for the service to be in a certain state.</p>
<h2 id='adding-custom-events'>Adding Custom Events</h2><pre class="highlight javascript tab-javascript"><code><span class="c1">//in PriceService.js</span>
<span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'event'</span><span class="p">).</span><span class="nx">registerPollEvents</span><span class="p">({</span>
      <span class="s1">'price/ETH_USD'</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">price</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">getEthPrice</span><span class="p">()</span>
      <span class="p">}</span>
    <span class="p">});</span>
</code></pre>
<p>One way to add an event is to “register” a function that gets called on each new block, using the event service&#39;s <code>registerPollEvents()</code> function.  For example, here is some code from the price service.
<code>this.getEthPrice()</code> will be called on each new block, and if the state has changed from the last call, a <code>price/ETH_USD</code> event will be emitted with the payload { price: [new_price] }.</p>
<pre class="highlight javascript tab-javascript"><code><span class="c1">//in Web3Service.js</span>
<span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'event'</span><span class="p">).</span><span class="nx">emit</span><span class="p">(</span><span class="s1">'web3/INITIALIZED'</span><span class="p">,</span> <span class="p">{</span>
  <span class="na">provider</span><span class="p">:</span> <span class="p">{</span> <span class="p">...</span><span class="nx">settings</span><span class="p">.</span><span class="nx">provider</span> <span class="p">}</span>
<span class="p">});</span>
</code></pre>
<p>Another way to an add an event is to manually emit an event using the event service&#39;s <code>emit</code> function.  For example, when the Web3Service initializes, it emits an event that contains info about the provider.</p>
<pre class="highlight javascript tab-javascript"><code><span class="c1">//in the constructor in the Cdp.js</span>
<span class="k">this</span><span class="p">.</span><span class="nx">_emitterInstance</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_cdpService</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'event'</span><span class="p">).</span><span class="nx">buildEmitter</span><span class="p">();</span>
<span class="k">this</span><span class="p">.</span><span class="nx">on</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_emitterInstance</span><span class="p">.</span><span class="nx">on</span><span class="p">;</span>
<span class="k">this</span><span class="p">.</span><span class="nx">_emitterInstance</span><span class="p">.</span><span class="nx">registerPollEvents</span><span class="p">({</span>
  <span class="na">COLLATERAL</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">USD</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">getCollateralValueInUSD</span><span class="p">(),</span>
    <span class="na">ETH</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">getCollateralValueInEth</span><span class="p">()</span>
  <span class="p">},</span>
  <span class="na">DEBT</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">dai</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">getDebtValueInDai</span><span class="p">()</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre>
<p>Note that calling <code>registerPollEvents</code> and <code>emit()</code> directly on the event service like in the previous two examples will register events on the &quot;default&quot; event emitter instance.  However, you can create a new event emitter instance for your new service.  For example, the CDP object defines it&#39;s own event emitter, as can be seen here, by calling the event service&#39;s <code>buildEmitter()</code> function.</p>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="javascript">javascript</a>
          </div>
      </div>
    </div>
  </body>
</html>
